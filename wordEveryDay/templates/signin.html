{% extends "all.html" %}
  
  {% block title %}
     <title>
   wordEveryday - Sign In
  </title>
  {% endblock title %}

  {% block body %}

<div class="min-h-screen bg-gradient-to-r from-[#8ad6ff] to-[#f28bff] flex items-center justify-center px-4">
  <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
   <section class="bg-white bg-opacity-90 rounded-xl shadow-lg p-10 max-w-lg w-full">
    <h1 class="text-3xl font-extrabold text-[#004d40] mb-8 text-center">
     Create your wordEveryday account
    </h1>
    <form  class="flex flex-col space-y-6" novalidate="">
      {% csrf_token %}
     <label class="block">
      <span class="text-sm font-semibold text-[#004d40]">Username</span>
      <input aria-label="Full Name" class="mt-1 block w-full rounded-md border border-[#004d40] px-4 py-2 focus:outline-none focus:ring-2 focus:ring-[#004d40]" name="username" placeholder="Your Username" required="" type="text"/>
     </label>
     <label class="block">
      <span class="text-sm font-semibold text-[#004d40]">Email</span>
      <input aria-label="Email" class="mt-1 block w-full rounded-md border border-[#004d40] px-4 py-2 focus:outline-none focus:ring-2 focus:ring-[#004d40]" name="email" placeholder="you@example.com" required="" type="email"/>
     </label>
     <label class="block">
      <span class="text-sm font-semibold text-[#004d40]">Password</span>
      <input aria-label="Password" class="mt-1 block w-full rounded-md border border-[#004d40] px-4 py-2 focus:outline-none focus:ring-2 focus:ring-[#004d40]" name="password" placeholder="Create a password" required="" type="password"/>
     </label>
     <label class="block">
      <span class="text-sm font-semibold text-[#004d40]">Confirm Password</span>
      <input aria-label="Confirm Password" class="mt-1 block w-full rounded-md border border-[#004d40] px-4 py-2 focus:outline-none focus:ring-2 focus:ring-[#004d40]" name="confirm_password" placeholder="Confirm your password" required="" type="password"/>
     </label>
     <label class="block">
      <span class="text-sm font-semibold text-[#004d40]">Verification code</span>
      <input aria-label="Confirm Password" class="mt-1 block w-full rounded-md border border-[#004d40] px-4 py-2 focus:outline-none focus:ring-2 focus:ring-[#004d40]" name="confirm_code" placeholder="Confirm your Verification code" required="" type=""/>
     </label>
     <button class="bg-[#004d40] text-white font-semibold rounded-full px-6 py-3 text-lg hover:bg-[#00332f] focus:outline-none transition" type="button" id="subbtn">
      Send Verification Code
    </button>
    <p class="mt-6 text-center text-sm text-[#004d40]">
     Already have an account?
     <a class="text-[#004d40] font-semibold underline hover:text-[#00291f]" href="#">
      <a href="/login">Log In</a>
     </a>
    </p>
   </section>
  </div>
<script>
  const csrftoken = '{{ csrf_token }}';
  let x = true;
  let code="";

  document.getElementById("subbtn").addEventListener("click", function (event) {

    event.preventDefault();  // Fix 3: Use event object correctly

    const username = document.querySelector('input[name="username"]').value;
    const email = document.querySelector('input[name="email"]').value;
    const password = document.querySelector('input[name="password"]').value;
    const confirmPassword = document.querySelector('input[name="confirm_password"]').value;

    // First check if passwords match
    if (x === true && password === confirmPassword) {

      // Send code to email
      fetch('/send_code', {
        method: 'POST',
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": csrftoken
        },
        body: JSON.stringify({
          uname: username,
          email: email
        })
      })
      .then(response => response.json())
      .then(data => {
        console.log("Server response:", data);

        code = data.code;  
        
        document.getElementById("subbtn").textContent = "Submit";
        x = false;  
      })
      

    } else {
      // When button was clicked again (x is false) â€” send the full form
      console.log("Submitting form with code:", code);
      fetch('/signin', {
        method: 'POST',
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": csrftoken
        },
        body: JSON.stringify({
          uname: username,
          email: email,
          password: password,
          confirm_password: confirmPassword,
          confirm_code: document.querySelector('input[name="confirm_code"]').value,
          code: code,
        })
      })
      
    }

  });
</script>

  
    {% endblock body %}